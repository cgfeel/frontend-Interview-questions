# 整理网络相关的面试题

以下问题来自 `gate.io` 1 面：

### 🔴 `http/2` 相对于 `http/1.1` 更新了什么？

<details>

<summary>HTTP/2 相对于 HTTP/1.1 有以下主要更新：</summary>

**一、二进制分帧层**

在 `HTTP/2` 中，引入了二进制分帧层。`HTTP/1.1` 的报文是基于文本的，而 `HTTP/2` 将报文分割为更小的帧，并且以二进制格式传输。这带来了几个好处：

1. 更高效的解析：二进制格式的帧可以更快速地被解析，减少了处理时间。
2. 多路复用：允许在同一个连接上同时发送多个请求和响应，而无需按照顺序依次进行。每个请求和响应都被分割成不同的帧，它们可以交错传输，极大地提高了传输效率。

**二、多路复用**

`HTTP/1.1` 中，如果客户端同时发起多个请求，这些请求需要依次排队等待响应，即使它们所请求的资源可以并行获取。而在 `HTTP/2` 中：

1. 并行传输：多个请求和响应可以在同一个连接上同时进行传输，无需等待。这大大减少了页面加载时间，特别是对于包含大量资源的页面。
2. 消除队头阻塞：在 `HTTP/1.1` 中，如果一个请求出现问题，会阻塞后续请求的处理。而 `HTTP/2` 的多路复用机制消除了这种队头阻塞问题，一个请求的问题不会影响其他请求的传输。

**三、头部压缩**

`HTTP/2` 使用 `HPACK` 压缩算法对头部信息进行压缩：

1. 减少传输开销：`HTTP` 请求和响应的头部通常包含大量重复的信息，如 `Cookie`、`User-Agent` 等。通过压缩头部，可以显著减少传输的数据量，提高传输效率。
2. 动态表更新：`HPACK` 算法维护了一个动态表，用于存储已经出现过的头部字段和值。对于重复出现的头部信息，可以使用更短的编码进行传输。

**四、服务器推送**

`HTTP/2` 允许服务器主动向客户端推送资源：

1. 提前加载：服务器可以根据客户端的请求，预测客户端可能需要的其他资源，并主动将这些资源推送给客户端。这样，当客户端真正需要这些资源时，可以直接从缓存中获取，减少了请求的延迟。
2. 优化用户体验：对于一些首次访问的页面，服务器推送可以提前加载关键资源，提高页面的加载速度，提升用户体验。

> 但是 `chrome` 关闭了 `HTTP/2` 的服务推送：https://developer.chrome.com/blog/removing-push?hl=zh-cn

</details>

### 🔴 请聊一下 `http3`？

<details>

<summary>HTTP/3 是 HTTP 协议的一个重要演进版本，具有多方面的改进和特点，以下是对 HTTP/3 的详细介绍：</summary>

### 1. 基础协议的变化：

**从 `TCP` 到 `UDPs`**

`HTTP/1.1` 和 `HTTP/2` 都是基于 `TCP` 协议的，而 `HTTP/3` 则基于 `UDP` 协议。`TCP` 是一种面向连接、可靠的传输协议，但在一些情况下，如网络拥塞时，可能会出现队头阻塞等问题，影响传输效率。`UDP` 是一种无连接的协议，本身不可靠，但 `HTTP/3` 在 `UDP` 的基础上进行了改进和增强，使其能够提供可靠的传输服务。

> `HTTP/1.1` 和 `HTTP/2` 都是基于 `TCP` 协议，而 `HTTP/3` 选择 `UDP` 协议主要是为了解决 `TCP` 协议存在的一些问题。虽然 `TCP` 是一种可靠的、面向连接的传输协议，但在某些情况下，比如网络拥塞时，`TCP` 的性能表现可能不尽如人意，会出现连接建立时间长、队头阻塞等问题。而 `UDP` 是一种无连接的、不可靠的传输协议，本身不具备 `TCP` 的复杂拥塞控制和连接管理机制，但正因为如此，它在一些方面具有优势，比如更低的延迟和更高的传输效率。
>
> 为了在 `UDP` 协议的基础上实现可靠的数据传输，`HTTP/3` 采用了 `QUIC`（Quick UDP Internet Connections）协议。`QUIC` 协议在 `UDP` 之上实现了类似 `TCP` 的可靠性、拥塞控制、流量控制等功能，同时还具有一些额外的优势，如减少连接建立时间、支持连接迁移等。所以，`HTTP/3` 实际上是基于 `QUIC` 协议的，而 `QUIC` 协议是基于 `UDP` 协议的，这使得 `HTTP/3` 能够在保持高效传输的同时，提供可靠的数据传输服务。

### 2. 主要优势：

**多路复用改进：**

在 `HTTP/2` 中已经实现了多路复用，可以在一个连接上同时发送多个请求和响应，提高了传输效率。但 `HTTP/2` 的多路复用是基于 `TCP` 有序字节流的，在丢包的情况下仍然可能会出现队头阻塞问题，导致后续的请求和响应被阻塞。`HTTP/3` 基于 `UDP` 实现了真正的多路复用，每个请求和响应都被分割 c 提高了传输效率和并发能力。

**更快的连接建立：**

在 `HTTP/1.1` 和 `HTTP/2` 中，建立连接需要进行 `TCP` 三次握手和 `TLS` 握手，这两个过程会消耗一定的时间，增加了连接的延迟。`HTTP/3` 集成了 `TLS` 加密层，并且通过改进的握手机制，只需要 1 个 `RTT`（Round-Trip Time，往返时间）就可以完成连接建立和密钥协商，大大减少了连接建立的时间。

**连接迁移支持：**

在移动互联网环境下，设备的网络连接可能会频繁切换，例如从 `Wi-Fi` 切换到移动网络，或者在不同的基站之间切换。对于基于 `TCP` 的 `HTTP/1.1` 和 `HTTP/2` 来说，网络连接的切换可能会导致连接中断，需要重新建立连接。`HTTP/3` 的 `QUIC` 层实现了连接迁移功能，能够在网络连接发生变化时，保持连接的连续性，减少了连接中断和重新建立连接的开销。

**头部压缩优化：**

在移动互联网环境下，设备的网络连接可能会频繁切换，例如从 `Wi-Fi` 切换到移动网络，或者在不同的基站之间切换。对于基于 `TCP` 的 `HTTP/1.1` 和 `HTTP/2` 来说，网络连接的切换可能会导致连接中断，需要重新建立连接。`HTTP/3` 的 `QUIC` 层实现了连接迁移功能，能够在网络连接发生变化时，保持连接的连续性，减少了连接中断和重新建立连接的开销。

### 3. 应用场景：

**对实时性要求高的应用：**

例如在线游戏、实时视频会议等，这些应用对网络延迟和传输效率要求非常高，`HTTP/3` 的低延迟和高效传输特性能够为用户提供更好的体验。

**移动互联网应用：**

在移动网络环境下，网络连接的稳定性和带宽都可能受到限制，`HTTP/3` 的连接迁移功能和高效传输能力可以更好地适应移动网络的特点，为移动应用提供更稳定、快速的网络服务。

**大规模分布式系统：**

在大规模的分布式系统中，节点之间的通信频繁，对网络性能的要求很高。`HTTP/3` 的多路复用和高效传输特性可以提高系统的通信效率，降低系统的延迟和带宽消耗。

不过，`HTTP/3` 也面临一些挑战和问题，例如需要服务器和客户端的支持才能发挥其优势，在推广和普及过程中可能会遇到一些困难。但总体来说，`HTTP/3` 是未来网络通信的一个重要发展方向，具有广阔的应用前景。

</details>

### 🔴 `HTTP/3` 这么好为什么用的人不多？

<details>

<summary>尽管 HTTP/3 有诸多优势，但使用的人不多，主要有以下原因：</summary>

**1. 浏览器支持有限：**

- 在 `HTTP/3` 推出的初期，很多浏览器对其支持不完善或默认情况下是禁用的。虽然一些主流浏览器如 `Chrome`、`Firefox` 等已经支持 `HTTP/3`，但需要用户手动开启相关功能或者在特定的版本中才支持。这对于普通用户来说，使用 `HTTP/3` 需要额外的操作和了解，增加了使用的门槛，导致很多用户仍然使用默认的 `HTTP/1.1` 或 `HTTP/2`。
- 部分老旧版本的浏览器可能根本不支持 `HTTP/3`，而一些企业或机构由于各种原因无法及时更新浏览器，这也限制了 `HTTP/3` 的普及。

**2. 网络基础设施兼容性问题：**

- 中间设备和网络代理：网络中存在大量的中间设备，如防火墙、负载均衡器、反向代理等，这些设备在设计时主要是针对 `HTTP/1.1` 和 `HTTP/2` 基于 `TCP` 的协议。对于基于 `UDP` 的 `HTTP/3`，这些中间设备可能无法正确识别、处理或转发 `HTTP/3` 的数据包，导致数据传输出现问题。为了使这些设备支持 `HTTP/3`，需要对其进行升级或配置调整，这需要大量的时间和成本。
- 网络运营商：网络运营商的网络架构和设备也可能对 `HTTP/3` 的支持有限。一些网络运营商可能需要对其网络基础设施进行升级改造，才能更好地支持 `HTTP/3` 的传输，这需要投入大量的资金和资源，因此他们在推广和支持 `HTTP/3` 方面可能会比较谨慎。

**3. 服务器端配置和升级成本：**

- 服务器软件升级：要支持 `HTTP/3`，服务器需要安装相应的软件和库，并且进行配置和优化。对于一些老旧的服务器系统，可能需要进行较大的升级改造才能支持 `HTTP/3`，这会带来额外的成本和工作量。对于一些小型网站或资源有限的服务器管理员来说，可能会因为成本和技术难度而选择继续使用 `HTTP/1.1` 或 `HTTP/2`。
- 资源消耗和性能优化：`HTTP/3` 的实现需要消耗一定的服务器资源，例如 `CPU`、内存等。在高并发的情况下，服务器需要具备足够的性能来处理 `HTTP/3` 的请求，这可能需要对服务器进行硬件升级或优化，增加了服务器的运营成本。

**4. 网站开发者的认知和接受程度：**

- 学习成本：网站开发者需要学习和了解 `HTTP/3` 的新特性、协议规范和开发方法，这需要花费一定的时间和精力。对于已经熟悉 `HTTP/1.1` 和 `HTTP/2` 的开发者来说，切换到 `HTTP/3` 可能需要重新调整他们的开发思维和代码实现，存在一定的学习曲线。
- 兼容性问题：在将网站从 `HTTP/1.1` 或 `HTTP/2` 升级到 `HTTP/3` 的过程中，可能会出现一些兼容性问题，例如与现有插件、库或第三方服务的不兼容。开发者需要花费时间来解决这些兼容性问题，确保网站的正常运行，这也增加了开发者对 `HTTP/3` 的顾虑。

**5. 缺乏大规模应用案例和实践经验：**

- 由于 `HTTP/3` 相对较新，目前还没有足够多的大规模应用案例和实践经验可供参考。很多网站管理员和开发者对 `HTTP/3` 的性能、稳定性和安全性存在疑虑，担心在实际应用中会出现问题。相比之下，`HTTP/1.1` 和 `HTTP/2` 已经经过了长时间的实践检验，开发者和管理员对其性能和问题有更深入的了解，更愿意选择相对成熟的协议。

</details>
